(()=>{"use strict";document.querySelector(".buttons__container");const t=new class{constructor(t,i){this.arrOperations=["ac","%","/","*","-","+"],this.$el=document.querySelector(`#${t}`),this.$digit=document.querySelector("[data-digit]"),this.numberLimit=i.numberLimit,
//! this.roundingAfterDot() - Повертає розраховану кількість чисел після коми!!!
this.varDigitStr="",this.$buttonAC=document.querySelector("[data-clear]"),this.$buttonsMath=document.querySelectorAll("[data-math]"),this.negativeCount=1,this.equalCount=1,this.numA="",this.symbol="",this.numB="",this.resultAB="",this.returnAorB="",this.statusnoNumBEqualNumA=!1,this.digitCopy="",this.arrDigigt=["0"],this.mOn=!1,this.m=0,this.countMbtns=1,this.$screenM=document.querySelector(".calc__m-screen")}btnsTouchNumbers(){document.body.addEventListener("touchstart",(t=>{t.target.className.includes("button")&&t.target.closest(".button")&&"vibrate"in navigator&&navigator.vibrate(75);let i="",s=t.target.className;s.includes("button__m")&&(i="#737371"),s.includes("button__control")&&(i="#D9D9D9"),s.includes("button__number")&&(i="#737373"),s.includes("button__math")&&(i="#F3C895"),t.target.style.backgroundColor=i,t.target.style.transition="background-color 0s, opacity 0.5s, transform 0.2s"}),!1),document.body.addEventListener("touchend",(function(t){t.target.className;t.target.style.transition="background-color 0.5s, opacity 0.5s, transform 0.2s",setTimeout((function(){t.target.style.backgroundColor=""}),20)}),!1)}buttonACContent(){""!==this.numA||""!==this.numB?this.$buttonAC.innerHTML="C":""!==this.numA&&""!==this.numB||(this.$buttonAC.innerHTML="AC")}buttonAC(){"ac"===this.targetDataSet.clear&&(this.clearVars(),console.warn("AC clear!"))}clearVars(){this.$digit.innerHTML="0",this.varDigitStr="0",this.numA="",this.numB="",this.symbol="",this.resultAB="",this.returnAorB="",this.negativeCount=1,//!
this.equalCount=1,this.statusnoNumBEqualNumA=!1,this.mathBtnsClearActive()}clearOneSymbol(){if("c"===this.targetDataSet.clearone&&""!==this.returnAorB){this.mathBtnsClearActive();const t=()=>{this.varDigitStr=this.varDigitStr.slice(0,-1),this.numA=this.varDigitStr,this.returnAorB=this.varDigitStr},i=()=>{this.varDigitStr=this.varDigitStr.slice(0,-1),this.numB=this.varDigitStr,this.returnAorB=this.varDigitStr};""===this.symbol&&""===this.numB&&t(),""!==this.numA&&""!==this.symbol&&i(),""!==this.numA&&""!==this.numB||""===this.varDigitStr&&(this.varDigitStr="0"),"-"===this.varDigitStr&&(this.varDigitStr="0",this.AorB("-0","="),"-"===this.numA&&(this.numA="0",this.returnAorB="0"),"-"===this.numB&&(this.numB="0",this.returnAorB="0"))}}AorB(t,i){"string"==typeof this.targetDataSet.number&&""===this.symbol&&""===this.numB&&("="===i&&this.nextNumber(1,t,"="),"+"===i&&this.nextNumber(1,t,"+"),this.mathBtnsClearActive()),"string"==typeof this.targetDataSet.number&&""!==this.numA&&""!==this.symbol&&("="===i&&this.nextNumber(2,t,"="),"+"===i&&this.nextNumber(2,t,"+"),this.mathBtnsClearActive())}numbersEntryAorB(){this.AorB(this.targetDataSet.number,"+"),console.error("numAB() "+this.numAB())}mathBtnsClearActive(){for(let t of this.$buttonsMath){function i(){t.classList.remove("button__math-active")}i()}}symbolEntry(){this.equalCount>1&&"string"==typeof this.targetDataSet.math&&(this.numB=""),""!==this.numA&&"string"==typeof this.targetDataSet.math&&(this.equalCount=1,this.statusnoNumBEqualNumA=!1,this.symbol=this.targetDataSet.math,this.mathBtnsClearActive(),this.target.classList.toggle("button__math-active"),"."===this.lastIndex(this.varDigitStr)&&(this.varDigitStr=this.varDigitStr.replace(/\.$/d,"")))}numAB(){return""===this.symbol?this.numA:this.numB}returnVarAB(t){this.numA===this.numAB()?this.numA=t:this.numB===this.numAB()&&(this.numB=t)}nextNumber(t,i,s){switch(t){case 1://! ================================== case 1 ================================
this.fixMultiZero(this.numA),1===t&&"="===s&&(this.numA=i),1===t&&"+"===s&&(this.numA+=i),this.varDigitStr=this.numA,this.fixDots(),this.returnAorB=this.numA;break;case 2://! ================================== case 2 ================================
this.fixMultiZero(this.numB),2===t&&"="===s&&(this.numB=i),2===t&&"+"===s&&(this.numB+=i),this.fixDots(),this.varDigitStr=this.numB,this.returnAorB=this.numB}}fixMultiZero(t){"0"===t[0]&&"."!==t[1]&&(""!==this.numA&&""===this.numB&&(this.numA=this.numA.slice(1)),""!==this.numB&&(this.numB=this.numB.slice(1)))}lastIndex(t){return t[t.length-1]}fixDots(){this.returnVarAB(this.numAB().replace(/-[^.\d]+/g,"").replace(/^([^\.]*\.)|\./g,"$1")),this.varDigitStr=this.varDigitStr.replace(/-[^.\d]+/g,"").replace(/^([^\.]*\.)|\./g,"$1"),"."===this.lastIndex(this.varDigitStr)&&this.arrOperations.includes(this.targetDataSet.math)&&(this.varDigitStr=this.varDigitStr.replace(/\.$/d,""))}buttonNegative(){"-"===this.lastIndex(this.numAB())&&this.AorB(this.numAB().replace(/-$/g,"").replace(/^/g,"-"),"="),"-"===this.numAB()&&this.AorB(this.numAB().replace(/$/g,"0"),"="),"-"===this.numAB()[0]&&"0"===this.numAB()[1]&&"."!==this.numAB()[2]&&"string"==typeof this.numAB()[2]&&this.AorB(this.numAB().replace(/^-0/g,"-"),"=")}buttonsEqual(){"."===this.lastIndex(this.numB)&&this.numB.replace(/\.$/d,""),""!==this.numA&&""!==this.symbol&&""!==this.numB&&(this.equalCount+=1,console.warn("method ="),console.error("equalCount = "+this.equalCount),console.error("buttonsEqual() numB "+this.numB),this.varDigitStr=this.resultAB,this.numA=this.resultAB)}clearAfterEqualPressNum(){if("string"==typeof this.targetDataSet.number&&this.equalCount>1){let t="";t+=this.targetDataSet.number,this.clearVars(),this.AorB(t,"+"),t="",console.error("cccccccccccccccccccccccccclearAfterEqualPressNum() this.equalCount "+this.equalCount)}}equalSymbol(){this.arrOperations.includes(this.targetDataSet.math)&&""!==this.numA&&""!==this.symbol&&""!==this.numB&&(console.error("includes"),this.numA=this.resultAB,this.varDigitStr=this.numA,this.numB="")}noNumBEqualNumA(){""!==this.numA&&""!==this.symbol&&""===this.numB&&("="!==this.targetDataSet.equal&&"m+"!==this.targetDataSet.m&&"m-"!==this.targetDataSet.m||(this.numB=this.numA,this.mathOperations(),this.numA=this.resultAB,this.varDigitStr=this.numA,this.resultAB=this.numA,this.statusnoNumBEqualNumA=!0,this.equalCount+=1,this.mathBtnsClearActive()))}mathOperations(){if(console.warn("this.symbol "+this.symbol),""!==this.numA&&this.symbol&&""!==this.numB)switch(this.symbol){case"+":this.resultAB=Number(this.numA)+Number(this.numB),this.foFixedNumFloat();break;case"-":this.resultAB=Number(this.numA)-Number(this.numB),this.foFixedNumFloat();break;case"*":this.resultAB=Number(this.numA)*Number(this.numB),this.foFixedNumFloat();break;case"/":this.resultAB=Number(this.numA)/Number(this.numB),this.foFixedNumFloat()}}limitResultAB(){this.varDigitStr.toString().length>this.numberLimit?(this.varDigitStr=Number(this.varDigitStr).toExponential(this.roundingAfterDot()),this.isExponential=!0):this.isExponential=!1}foFixedNumFloat(){let t=parseInt(this.varDigitStr)+"";t=t.length,this.resultdigitLengthFloat=this.varDigitStr.length-t,this.resultdigitLengthFloat=this.resultdigitLengthFloat+"",this.varDigitStr.includes(".")&&this.resultdigitLengthFloat,console.error("this.resultdigitLengthFloat "+this.resultdigitLengthFloat),console.error(this.resultdigitLengthFloat),this.resultAB=this.fnToFixed(this.resultAB)}fnToFixed(t){return t=parseFloat(t).toFixed(this.roundingAfterDot()).replace(/0+$/g,"").replace(/\.$/g,"")}fixDotWithoutZero(){"."===this.numA&&(this.numA="0.",this.varDigitStr="0.",this.returnAorB="0."),"."===this.numB&&(this.numB="0.",this.varDigitStr="0.",this.returnAorB="0.")}formatNumberForDisplay(t){let[i,s]=t.split(".");i=i.replace(/\B(?=(\d{3})+(?!\d))/g," ");let e=s?`${i},${s}`:i;return"."!==this.lastIndex(t.toString())&&","!==this.lastIndex(t.toString())||(e+=","),e}roundingAfterDot(){let t=this.numberLimit-Math.floor(this.varDigitStr).toString().length;return t<=0&&(t=1),t}formattedDigitM(){let t=this.formatNumberForDisplay(this.m.toString());this.$screenM.innerHTML="M="+t,!1===this.mOn&&(this.$screenM.innerHTML="")}digitRender(){if(this.varDigitStr.replace(/\./,"").length<=this.numberLimit){let t=this.formatNumberForDisplay(this.varDigitStr);this.$digit.innerHTML=t}else if(this.varDigitStr.length>this.numberLimit){//! Форматує результат в науковий формат (число Ейлера або експоненційний формат)
this.$digit.innerHTML=Number(this.varDigitStr).toExponential().replace("e+","e");let t=this.$digit.innerHTML.length;const i=new RegExp(/^([+-]?\d+(\.\d+)?)e([+-]?\d+)$/,"g");let s=this.$digit.innerHTML.replace(i,"$1").replace(/0+$/g,""),e=this.numberLimit-(t-s.length+Math.floor(+s).toString().length);console.log("formatEtoN",s),this.$digit.innerHTML=Number(this.varDigitStr).toExponential(e).replace(/\.?0+e/g,"e").replace("e+","e").replace(/\./,",")}
//! Динамічне зменшення / збільшення розміру шрифту в циферблаті
const t=document.querySelector(".calc__screen"),i=parseFloat(getComputedStyle(t).paddingLeft),s=parseFloat(getComputedStyle(t).paddingRight),e=t.offsetWidth-i-s;console.log("widthContainer",e),console.log("this.$digit",this.$digit.offsetWidth);let r=parseInt(window.getComputedStyle(this.$digit).fontSize);for(;this.$digit.offsetWidth>e&&r>=48;)r-=1,this.$digit.style.fontSize=`${r}px`;for(;this.$digit.offsetWidth<e&&r<=87.5;)r+=1,this.$digit.style.fontSize=`${r}px`}blinkingDigit(){this.arrDigigt.push(this.varDigitStr),this.arrDigigt=this.arrDigigt.slice(-2),console.log("this.arrDigigt",this.arrDigigt),this.arrDigigt[0]===this.arrDigigt[1]&&(this.$digit.style.opacity=0,setTimeout((()=>{this.$digit.style.opacity=1}),100))}trueAllVars(){if(""!==this.numA&&""!==this.numB&&""!==this.symbol)return!0}percentBtn(t){//! кнопки і операції => 10, %, =0.1 (numA = numA / 100)
document.querySelector("[data-equal]");"%"===t.dataset.percent&&(""!==this.numA&&""===this.numB?(""===this.symbol&&(this.numA=this.fnToFixed(this.numA/100),this.varDigitStr=this.numA),"+"!==this.symbol&&"-"!==this.symbol||(//! кнопки і операції => 10, + or -, % (this.numB = this.numA / 100 * this.numA)
this.numB=this.fnToFixed(this.numA/100*this.numA),this.varDigitStr=this.numB,console.log("if percent",1)),"*"!==this.symbol&&"/"!==this.symbol||(//! кнопки і операції => 10, * or /, % (this.numB = this.numA / 100)
this.numB=this.fnToFixed(this.numA/100),this.varDigitStr=this.numB,console.log("if percent",2))):""!==this.numA&&""!==this.numB&&("+"!==this.symbol&&"-"!==this.symbol||(//! кнопки і операції => 50, + or -, 20, % (this.numB = this.numA / 100 * this.numB)
this.numB=this.fnToFixed(this.numA/100*this.numB),this.varDigitStr=this.numB,console.log("if percent",3)),"*"!==this.symbol&&"/"!==this.symbol||(//! кнопки і операції => 50, + or -, 20, % (this.numB = this.numA / 100 * this.numB)
this.numB=this.fnToFixed(this.numB/100),this.varDigitStr=this.numB,console.log("if percent",4))))}fixMBtns(t){this.countMbtns>1&&t.dataset.number&&(this.numA="",this.symbol="",this.numB="")}btnMplus(t){(t.dataset.number||t.dataset.math)&&(this.countMbtns=1),"mc"===t.dataset.m&&(this.m=0,this.$screenM.innerHTML="",this.mOn=!1),"m+"!==t.dataset.m&&"m-"!==t.dataset.m||(this.countMbtns+=1,this.mOn=!0,""!==this.numA&&""!==this.numB&&""!==this.symbol&&1===this.equalCount?(this.buttonsEqual(),"m+"===t.dataset.m&&(this.m=Number(this.m)+Number(this.varDigitStr)),"m-"===t.dataset.m&&(this.m=Number(this.m)-Number(this.varDigitStr)),""!==this.numA&&""!==this.symbol&&""===this.numB&&this.equalCount>1&&(this.numB="",this.symbol="",this.noNumBEqualNumA()),this.$screenM.innerHTML=this.m):("m+"===t.dataset.m&&(this.m=Number(this.m)+Number(this.varDigitStr)),"m-"===t.dataset.m&&(this.m=Number(this.m)-Number(this.varDigitStr)),this.$screenM.innerHTML=this.m),this.numA=this.m,this.numB="",this.symbol=""),"mr"===t.dataset.m&&(""===this.numB&&""===this.symbol?(this.numA=this.m,this.varDigitStr=""+this.m):""!==this.numA&&""!==this.symbol&&(this.numB=this.m,this.varDigitStr=""+this.m))}}("buttonsCalc",{numberLimit:9});t.btnsTouchNumbers(),t.$el.addEventListener("click",(i=>{i.target.closest(".button")&&(t.targetDataSet=i.target.dataset,t.target=i.target,console.warn("press targetttttttttttttttttttttttttttttttt!!! "+t.targetDataSet),t.targetDataSet,t.symbolEntry(),t.fixMBtns(i.target),t.varDigitStr.length<=t.numberLimit&&(t.varDigitStr.includes(".")||t.varDigitStr.length<t.numberLimit)&&t.numbersEntryAorB(),t.buttonNegative(),"="===t.targetDataSet.equal&&t.buttonsEqual(),t.percentBtn(i.target),t.noNumBEqualNumA(),t.btnMplus(i.target),t.formattedDigitM(),t.clearOneSymbol(),t.mathOperations(),//! Запуск математичної операції
t.buttonAC(),t.fixDotWithoutZero(),t.clearAfterEqualPressNum(),t.buttonACContent(),t.digitRender(),t.blinkingDigit(),
//! рперший нуль тільки один!
console.group("looooooooooooooooooooooooooooooooooooooooogs"),//! LOGS
console.warn("statuslastDot "+t.statuslastDot),console.warn("statusnoNumBEqualNumA "+t.statusnoNumBEqualNumA),console.warn("equalCount "+t.equalCount),console.log("numA = "+t.numA),console.log("symbol = "+t.symbol),console.log("numB = "+t.numB),console.log("resultAB = "+t.resultAB),console.log("equalCount = "+t.equalCount),console.log("countMbtns = "+t.countMbtns),console.log("returnAorB  "+t.returnAorB),console.log("numAB()  "+t.numAB()),console.warn("calc.negativeCount "+t.negativeCount),console.warn("last symbol in digit "+t.returnAorB[t.returnAorB.length-1]),console.warn("digitCopy ",t.digitCopy),console.warn("$digit ",t.$digit.innerHTML),console.warn("varDigitStr ",t.varDigitStr),console.warn("roundingAfterDot()",t.roundingAfterDot()),console.warn("M+",t.m))})),window.FLS=!0,function(t){let i=new Image;i.onload=i.onerror=function(){t(2==i.height)},i.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(t){let i=!0===t?"webp":"no-webp";document.documentElement.classList.add(i)}))})();